{% extends 'base.html' %}

{% load staticfiles %}

{% block title %}
    {{ requested_user.username }}
{% endblock %}

{% block script_head %}
    <script src="{% static 'js/events/hide_show_event.js' %}"></script>
    <script>
        function SendFriendRequest(ref) {
            var data = {'to_user_pk': '{{ requested_user.pk }}', 'csrfmiddlewaretoken': '{{ csrf_token }}'};
            var url = '{% url 'invitations:send_friend_request' %}';
            $.post(url, data, function(json){
                if (json.created){
                    $(ref).html('Invite sent').addClass('btn-success disabled');
                }
                else {
                    $(ref).html('Error').addClass('btn-danger disabled');
                }
            }, 'json');
        }
    </script>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading text-center">
                    <span class="glyphicon glyphicon-user"></span>
                    <div class="text-nowrap dots">{{ requested_user.username }}</div>
                    <br>
                    <div>
                        {% if user == requested_user %}
                            <a href="{% url 'userprofiles:update' requested_user.username %}" class="btn btn-default btn-sm btn-block">Update profile</a>
                            <a href="{% url 'account_change_password' %}" class="btn btn-default btn-sm btn-block">Change password</a>
                        {% elif user.is_authenticated %}
                            {% if invite_status %}
                                {% if invite_status == 'A' %}
                                    <button class="btn btn-success btn-sm btn-block">Friends</button>
                                {% elif invite_status == 'P' %}
                                    <button class="btn btn-info btn-sm btn-block" disabled>Friend request has been sent</button>
                                {% elif invite_status == 'D' %}
                                    <button class="btn btn-info btn-sm btn-block">{{ requested_user.username }} has sent invitation to you</button>
                                {% endif %}
                            {% else %}
                                <button onclick="SendFriendRequest(this)" class="btn btn-primary btn-sm btn-block">Send friend request</button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                <div class="panel-body" style="padding: 1px;">
                    <br>
                    <div class="row">
                        <div class="col-xs-3 text-right"><strong>First name:</strong></div>
                        <div class="col-xs-9 text-nowrap dots">{{ requested_user.first_name }}</div>
                    </div>
                    <div class="row">
                        <div class="col-xs-3 text-right"><strong>Last name:</strong></div>
                        <div class="col-xs-9 text-nowrap dots">{{ requested_user.last_name }}</div>
                    </div>
                    <div class="row">
                        <div class="col-xs-3 text-right"><strong>Email:</strong></div>
                        <div class="col-xs-9 text-nowrap dots">{{ requested_user.email }}</div>
                    </div>
                    <div class="row">
                        <div class="col-xs-3 text-right"><strong>Website:</strong></div>
                        <div class="col-xs-9 text-nowrap dots"><a href="{{ requested_user.profile.website }}">{{ requested_user.profile.website }}</a></div>
                    </div>
                    <br>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            {% if user == requested_user %}
                {% include 'events/snippets/events_tabs.html' %}
            {% else %}
                <div class="panel panel-primary">
                    <div class="panel-heading text-center">Public events</div>
                </div>
                {% include 'events/snippets/time_frame_btns.html' %}
                <br>
                {% include 'events/snippets/events_list_group.html' %}
            {% endif %}
        </div>
    </div>
{% endblock %}